# Обновление по воздуху - ОТА

В некоторых случаях собранное устройство - блок управления матрицей - размещено в местах, доступ к которым затруднён.
Для обновлении прошивки обычным способом - через подключение к компьютеру через USB кабель, требуется отсоединять устройство от матрицы,
вскрывать его корпус для доступа к микроконтроллеру.  

Чтобы упростить процесс обновления микропрограммы устройства в прошивку была введена поддержка обновления "по воздуху" - 
Over the Air (ОТА).  

## Обновление по воздуху

![OTA](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/OTA/picture-1.png)

Для беспроводного обновления прошивки выполните следующие шаги:  

### Шаг 1

Запустите **Arduino IDE**. В меню **"Инструменты"** нажмите на пункт **"Порт"**.
Если ваше устройство работает уже какое-то время, роутер знает его адрес и предоставляет список
обнаруженных активных устройств среде IDE. Этот список доступен в выпадающем подменю, открывающемся
при выборе меню **"Порт"**.   

```
В некоторых случаях в точно знаете, что устройство в сети, его интерфейс доступен в браузере, но Arduino IDE упорно
не находит его в сети и его IP-адрес отсутствует в меню "Порт". Причина такого поведения неизвестна. Возможно это ошибка
Arduino IDE. Во всяком случае замечено, что Arduino IDE версий 2.x обнаруживают активные устройства в сети
гораздо быстрее и стабильнее.

Если Arduino IDE версии 1.8.xx не видит устройство в сети, попробуйте следующее:
1. Закройте Arduino IDE
2. Выключите роутер, подождите, и через некоторое время включите его обратно.
3. Запустите Arduino IDE.

В некоторых случаях после выполнения этих действий работающее устройство находится в сети.
Если устройство так и не обнаружено - отложите затею беспроводного обновления на некоторое время.
Возможно на следующий день ситуация исправится сама собой.
```

### Шаг 2

После того как сетевой порт назначенный вашему устройству выбран, нажмите в Arduino IDE  кнопку "Загрузить",
как это делается при обычном обновлении по кабелю.  

Дождитесь завершения компиляции скетча и окончании его загрузки в микроконтроллер по воздуху.  

![OTA](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/OTA/picture-2.png)

В Arduino IDE вы увидите надпись ***`Uploading...`***, затем **"Загрузка завершена"** в строке статуса терминала Arduino IDE.  

### Шаг 3

Если в прошивке обновился Web-интерфейс, его файлы также должны быть выгружены в файловую систему микроконтроллера.
К этому моменту у вас уже должны быть [установлены плагины](https://github.com/vvip-68/LedPanelWiFi/wiki/Загрузка-данных-в-файловую-систему-МК) 
для работы с файловой системой микроконтроллера LittleFS.  

![OTA](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/OTA/picture-3.png)

Убедитесь, что в меню **"Инструменты"** в пункте **"Порт"** по прежнему выбран сетевой порт, принадлежащий вашему устройству.
Нажмите в меню пункт **"ESP8266 LittleFS Data Upload"**, если устройство собрано на микроконтроллере ESP8266 (Wemos d1 mini, NodeMCU) или
**"ESP32 LittleFS Data Upload"**, если устройство собрано на базе микроконтроллера ESP32.  

### Шаг 4

Ожидайте завершения операции. После того, как загрузка файлов будет выполнена, в строке статуса терминала Arduino IDE
появится надпись **"LittleFS Image Uploaded"**.  

![OTA](https://github.com/vvip-68/LedPanelWiFi/blob/main/wiki/OTA/picture-4.png)

Микроконтроллер устройства автоматически перезагрузится и устройство продолжит свою работу.  
На этом процесс обновления прошивки по воздуху завершен.  


